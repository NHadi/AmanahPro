<!DOCTYPE html>
<html lang="en">
  <header id="header"></header>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .charts-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px; /* Space between the charts */
      margin-top: 30px;
    }
  
    .chart-card {
      flex: 1; /* Allow equal width */
      padding: 20px;
      background-color: #ffffff;
      border: 1px solid #e3e3e3;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
  
    .chart-card canvas {
      display: block;
      max-width: 100%;
      height: auto;
      margin: 0 auto;
    }
  </style>
  
  <body class="g-sidenav-show bg-gray-100">
    <div class="min-height-300 bg-dark position-absolute w-100"></div>
    <aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4" id="sidenav-main">
    </aside>
    <main class="main-content position-relative border-radius-lg">
      <nav id="navbar"></nav>
      <div class="container-fluid py-4">
        
          <!-- Summary Cards -->
          <div class="row mb-4">
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
              <div class="card">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="numbers">
                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Total BA Count</p>
                        <h5 class="font-weight-bolder">5</h5>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                        <i class="ni ni-collection text-lg opacity-10"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
              <div class="card">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="numbers">
                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Progress This Month</p>
                        <h5 class="font-weight-bolder">204.48 mÂ²</h5>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-gradient-success shadow text-center border-radius-md">
                        <i class="ni ni-sound-wave text-lg opacity-10"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
              <div class="card">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="numbers">
                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Progress</p>
                        <h5 class="font-weight-bolder">71.44%</h5>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-gradient-warning shadow text-center border-radius-md">
                        <i class="ni ni-chart-bar-32 text-lg opacity-10"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-6">
              <div class="card">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="numbers">
                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Weight (BOBOT)</p>
                        <h5 class="font-weight-bolder">100%</h5>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-gradient-info shadow text-center border-radius-md">
                        <i class="ni ni-chart-pie-35 text-lg opacity-10"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        
          <!-- Progress Tracking Table -->
          <div class="card mb-4">
            <div class="card-body p-3">
              <div id="ba-grid"></div>
            </div>
          </div>
        
          <div class="charts-row">
            <!-- Progress Chart -->
            <div class="chart-card">
              <h5 class="text-center">Progress Tracking by Area</h5>
              <canvas id="baProgressChart"></canvas>
            </div>
          
            <!-- BA Progress Visualization -->
            <div class="chart-card">
              <h5 class="text-center">Total Progress by Project</h5>
              <canvas id="projectProgressChart"></canvas>
            </div>
          
            <!-- Area-Specific Progress Analysis -->
            <div class="chart-card">
              <h5 class="text-center">Progress by Areas for Each Project</h5>
              <canvas id="areaProgressChart"></canvas>
            </div>
          </div>
          
      </div>
    </main>

    <!-- Core JS Files -->
    <script src="template/assets/js/core/popper.min.js"></script>
    <script src="template/assets/js/core/bootstrap.min.js"></script>
    <script src="template/assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="template/assets/js/plugins/smooth-scrollbar.min.js"></script>
    <script src="template/assets/js/plugins/chartjs.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DevExtreme JS -->
    <script src="https://cdn3.devexpress.com/jslib/22.1.6/js/dx.all.js"></script>    
    <script src="template/assets/js/common.js"></script>
    <script>
      $(function () {

   // Static data representing the structure
   const projectData = [
    {
      projectName: "Project A",
      areas: [
        {
          area: "Female Toilet",
          details: [
            { no: 1, description: "Jasa pasang lantai", qty: 16, unit: "m2", bobot: 5.43, lastProgress: 0, currentProgress: 4.62, totalProgress: 13.62 },
            { no: 2, description: "Jasa pasang dinding", qty: 42.76, unit: "m2", bobot: 14.79, lastProgress: 0, currentProgress: 11.21, totalProgress: 32.42 },
          ],
        },
        {
          area: "Male Toilet",
          details: [
            { no: 1, description: "Jasa pasang lantai", qty: 21.02, unit: "m2", bobot: 7.14, lastProgress: 0, currentProgress: 4.39, totalProgress: 12.32 },
            { no: 2, description: "Jasa pasang dinding", qty: 61.08, unit: "m2", bobot: 21.12, lastProgress: 0, currentProgress: 21.20, totalProgress: 61.31 },
          ],
        },
      ],
    },
    {
      projectName: "Project B",
      areas: [
        {
          area: "Nursery",
          details: [
            { no: 1, description: "Jasa pasang lantai", qty: 4.68, unit: "m2", bobot: 1.59, lastProgress: 0, currentProgress: 1.52, totalProgress: 4.47 },
            { no: 2, description: "Jasa pasang dinding", qty: 23.94, unit: "m2", bobot: 8.28, lastProgress: 0, currentProgress: 8.21, totalProgress: 23.73 },
          ],
        },
      ],
    },
  ];

  // Initialize the grid
  $("#ba-grid").dxDataGrid({
    dataSource: projectData,
    keyExpr: "projectName",
    showBorders: true,
    columns: [
      { dataField: "projectName", caption: "Project Name" },
    ],
    masterDetail: {
      enabled: true,
      template: function (container, options) {
        const projectAreas = options.data.areas;
        $("<div>")
          .dxDataGrid({
            dataSource: projectAreas,
            keyExpr: "area",
            columns: [{ dataField: "area", caption: "Area" }],
            showBorders: true,
            masterDetail: {
              enabled: true,
              template: function (innerContainer, innerOptions) {
                const areaDetails = innerOptions.data.details;
                $("<div>")
                  .dxDataGrid({
                    dataSource: areaDetails,
                    showBorders: true,
                    columns: [
                      { dataField: "no", caption: "No", width: 50 },
                      { dataField: "description", caption: "Area Pemasangan" },
                      { dataField: "qty", caption: "Qty", dataType: "number" },
                      { dataField: "unit", caption: "Unit" },
                      { dataField: "bobot", caption: "Bobot (%)", format: { type: "fixedPoint", precision: 2 } },
                      { dataField: "lastProgress", caption: "Progress Lalu (%)", format: { type: "fixedPoint", precision: 2 } },
                      { dataField: "currentProgress", caption: "Progress Ini (%)", format: { type: "fixedPoint", precision: 2 } },
                      { dataField: "totalProgress", caption: "Total Progress (%)", format: { type: "fixedPoint", precision: 2 } },
                    ],
                    summary: {
                      totalItems: [
                        { column: "bobot", summaryType: "sum", displayFormat: "Total: {0}" },
                        { column: "lastProgress", summaryType: "sum", displayFormat: "Total: {0}" },
                        { column: "currentProgress", summaryType: "sum", displayFormat: "Total: {0}" },
                        { column: "totalProgress", summaryType: "sum", displayFormat: "Total: {0}" },
                      ],
                    },
                  })
                  .appendTo(innerContainer);
              },
            },
          })
          .appendTo(container);
      },
    },
  });
         // Static BA Data
        const baData = [
          { area: "Female Toilet", bobot: 20, lastProgress: 0, currentProgress: 17.43, totalProgress: 17.43 },
          { area: "Male Toilet", bobot: 25, lastProgress: 0, currentProgress: 21.20, totalProgress: 21.20 },
          { area: "Difable Toilet", bobot: 15, lastProgress: 0, currentProgress: 12.68, totalProgress: 12.68 },
          { area: "Nursery", bobot: 10, lastProgress: 0, currentProgress: 8.27, totalProgress: 8.27 },
          { area: "PRELIMINARIES", bobot: 30, lastProgress: 0, currentProgress: 12.20, totalProgress: 12.20 },
        ];


        // Render BA Progress Chart
        const ctx = document.getElementById("baProgressChart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: baData.map((item) => item.area),
            datasets: [
              {
                label: "Progress (%)",
                data: baData.map((item) => item.totalProgress),
                backgroundColor: "rgba(75, 192, 192, 0.6)",
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
              },
            },
          },
        });


         // Static BA Data for Projects
  const baProjects = [
    { project: "Project A", totalProgress: 71.44, areas: { "Female Toilet": 17.43, "Male Toilet": 21.20, "Difable Toilet": 12.68, "Nursery": 8.27, "PRELIMINARIES": 12.20 } },
    { project: "Project B", totalProgress: 55.32, areas: { "Female Toilet": 12.45, "Male Toilet": 18.10, "Difable Toilet": 9.88, "Nursery": 7.50, "PRELIMINARIES": 7.39 } },
    { project: "Project C", totalProgress: 83.76, areas: { "Female Toilet": 25.00, "Male Toilet": 30.50, "Difable Toilet": 15.76, "Nursery": 7.50, "PRELIMINARIES": 5.00 } },
  ];

  // Prepare Data for Total Progress Chart
  const projectNames = baProjects.map((item) => item.project);
  const totalProgressData = baProjects.map((item) => item.totalProgress);

  // Render Total Progress by Project Chart
  const ctx1 = document.getElementById("projectProgressChart").getContext("2d");
  new Chart(ctx1, {
    type: "bar",
    data: {
      labels: projectNames,
      datasets: [
        {
          label: "Total Progress (%)",
          data: totalProgressData,
          backgroundColor: "rgba(75, 192, 192, 0.6)",
          borderColor: "rgba(75, 192, 192, 1)",
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: {
            display: true,
            text: "Progress (%)",
          },
        },
        x: {
          title: {
            display: true,
            text: "Projects",
          },
        },
      },
    },
  });

  // Prepare Data for Area-Specific Progress Chart
  const areaLabels = Object.keys(baProjects[0].areas);
  const areaDatasets = baProjects.map((project) => ({
    label: project.project,
    data: Object.values(project.areas),
    backgroundColor: `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.6)`,
  }));

  // Render Area-Specific Progress Chart
  const ctx2 = document.getElementById("areaProgressChart").getContext("2d");
  new Chart(ctx2, {
    type: "bar",
    data: {
      labels: areaLabels,
      datasets: areaDatasets,
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "top" },
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: "Progress (%)",
          },
        },
        x: {
          title: {
            display: true,
            text: "Areas",
          },
        },
      },
    },
  });

      });
    </script>
  </body>
  </html>